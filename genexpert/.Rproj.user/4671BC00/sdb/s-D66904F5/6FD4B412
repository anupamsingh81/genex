{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(ggplot2)\n\nmaster = master.chart %>% select(-c(ADA,SUGAR,PROTEIN,TLC.DLC))\n\nsummary(master$AFB.CULTURE)\n\nsummary(master$AFB.SMEAR)\n\nsummary(master$MTB.DETED)\n\n\nmaster1 = master %>% filter(!(AFB.CULTURE==\"NOT SENT\"|AFB.CULTURE==\"NA\"|AFB.CULTURE==\"IN PROCESS\"|AFB.CULTURE==\"INPROGRESS\"|\n                    AFB.SMEAR==\"\"|AFB.SMEAR==\"NOT SENT\"|AFB.SMEAR==\"NA\"))\n                  \n                  \nsummary(master1$MTB.DETED)\n\nsummary(master1$AFB.SMEAR)\n\nsummary(master1$AFB.CULTURE)\n\nmaster2 = master1 %>% filter(!(MTB.DETED==\"INPROGRESS\"|MTB.DETED==\"IN PROCESS\"|MTB.DETED==\"EXPIRED\"|\n                                 MTB.DETED==\"REJECTED\"))\n\nsummary(master2$MTB.DETED==\"D\"|master2$MTB.DETED==\" D\")\n\nlibrary(stringr)\nlibrary(tidyverse)\n\nsummary(str_detect(master2$MTB.DETED,\"D\"))\n\nmaster2$xpert = ifelse(str_detect(master2$MTB.DETED,\"D\"),\"Positive\",\"Negative\")\n\nsummary(as.factor(master2$xpert))\n\nsummary(master2$AFB.SMEAR)\n\nmaster2$smear = ifelse(master2$AFB.SMEAR==\"Y\"|master2$AFB.SMEAR==\"P\",\"Positive\",\"Negative\")\n\nsummary(as.factor(master2$smear))\n\n\nsummary(str_detect(master2$AFB.CULTURE,\"NG AT\"))\n\nmaster2=master2 %>% filter(!(str_detect(AFB.CULTURE,\"NA\")))\n\nmaster2$culture = ifelse(str_detect(master2$AFB.CULTURE,\"NG AT\")|str_detect(master2$AFB.CULTURE,\"NG AFTER\"),\"Negative\",\"Positive\")\n\nmaster2$time = str_extract(master2$AFB.CULTURE,\"[0-9]\") # Extract numeric\n\nsummary(master2$L.M.H)\n\nsummary(as.factor(master2$xpert))\n\nmaster2$ct = ifelse(str_detect(master2$L.M.H,\"VL\"),\"VL\",\n                 ifelse(str_detect(master2$L.M.H,\"L\"),\"L\",\n                                        \n              ifelse(str_detect(master2$L.M.H,\"M\"),\"M\",\n              ifelse(str_detect(master2$L.M.H,\"H\"),\"H\",\n                                         \"\"))))\n\nmaster2$ct = ifelse(!(master2$ct==\"H\"|master2$ct==\"M\"|master2$ct==\"L\"|master2$ct==\"VL\"),NA,master2$ct) # Avoid \"NA\" in string\n\nsummary(as.factor(master2$ct))\n\nfit= aov(master2$time~master2$ct)\nplot(fit)\nTukeyHSD(fit)\n\nlibrary(ggplot2)\n\nmaster2$time = as.numeric(master2$time)\n\nmaster2  %>%filter(!is.na(ct)) %>%   ggplot(aes(x= reorder(ct,time,FUN=median),y=time,fill=ct))+geom_boxplot()+ coord_flip()+\nlabs( title = \" Time to positivity decreases with higher Ct\",\n        x = \"Ct\",\n        y= \"Time to positivity\")\n# I marked + at start of labs and was stuck, be careful\n\nmaster2 %>% group_by(culture,smear,ct) %>% summarize(n=n(),mean=mean(time),sd=sd(time))\n\nmaster2 %>% group_by(culture,ct) %>% summarize(n=n())\n\nmaster2 %>% group_by(culture,smear,xpert) %>% summarize(n=n())\n\n\nf= master2 %>% group_by(specimen,culture,smear,xpert) %>% summarize(n=n())\n\nprint.data.frame(f)\n\n\nmaster2 %>% group_by(culture,xpert,smear) %>% summarize(n=n())\n\nmaster2 %>% group_by(culture,smear) %>% summarize(n=n())\n\nmaster2 %>% group_by() %>% summarize(n=n())\n\n\n\n\n\nmaster2 %>% filter(!is.na(ct)) %>% ggplot(aes(reorder(ct,time),time))+stat_summary(fun.y=mean,fun.ymin=min,fun.ymax=max) +coord_flip()+\n  labs( title = \" Time to positivity decreases with higher Ct\",\n        x = \"Ct\",\n        y= \"Time to positivity\")\n\nsummary(as.factor(master2$SPECIMENTYPE)))\n\nsummary(str_detect(master2$SPECIMENTYPE,\"BAL\"))\n\nsummary(str_detect(master2$SPECIMENTYPE,\"PL\"))\n\nsummary(str_detect(master2$SPECIMENTYPE,\"SPUTUM\"))\n\n\n\nmaster2$specimen = ifelse(str_detect(master2$SPECIMENTYPE,\"BAL\")|str_detect(master2$SPECIMENTYPE,\"LUNG\")|str_detect(master2$SPECIMENTYPE,\"Bronchial\"),\"BAL\",\n                          ifelse(str_detect(master2$SPECIMENTYPE,\"PL\"),\"Pleural\",\n                                ifelse(str_detect(master2$SPECIMENTYPE,\"SPUTUM\"),\"Sputum\",\"Others\" )))\n\nsummary(as.factor(master2$specimen))\n\nk = master2 %>% group_by(specimen,culture,smear,xpert) %>% summarize(n=n()) %>% arrange(desc(n)) \nprint.data.frame(k)\n\nl=master2 %>% group_by(specimen,culture,ct) %>% summarize(n=n()) %>% arrange(desc(n))\nprint.data.frame(l)\n\nn=master2 %>% group_by(specimen,culture,smear,ct) %>% summarize(n=n(),mean=mean(time),sd=sd(time))\n\nprint.data.frame(n)\n\n\nm=master2 %>% group_by(specimen,culture,smear,ct) %>% summarize(n=n(),mean=mean(time),sd=sd(time))\n\nprint.data.frame(m)\n\nn=master2 %>% group_by(specimen,culture,smear,ctd) %>% summarize(n=n(),mean=mean(time),sd=sd(time))\n\nprint.data.frame(n)\n\n\ntable(master2$xpert,master2$culture)\ntable(master2$smear,master2$culture)\n\n\n78/128\n\nwrite.csv(master2,\"doc.csv\")\n\n\nmaster2 %>% group_by(specimen) %>% filter(xpert==\"Positive\",culture==\"Negative\") %>% summarize(\n  n=n())\n\nk2 = as.data.frame(master2 %>% count(specimen))\nk2$n\n\np1 = master2 %>% group_by(specimen) %>% filter(xpert==\"Negative\",culture==\"Positive\") %>% summarize(\n  n=n()) %>% mutate(Total = k2$n,proportion = n/k2$n) %>% \n  ggplot(mapping= aes(x=reorder(specimen,proportion),proportion,fill=specimen)) + geom_bar(stat=\"identity\")+coord_flip()+ labs(\n    title = \"Discordant(Xpert negative,culture positive cases)\",\n    x= \"specimen\",\n    y= \"Proportion\")\n\n\n  \n\np2 =master2 %>% group_by(specimen) %>% filter(xpert==\"Positive\",culture==\"Negative\") %>% summarize(\n  n=n()) %>% mutate(Total = k2$n,proportion = n/k2$n) %>% ggplot(mapping= aes(x=reorder(specimen,proportion),proportion,fill=specimen)) + geom_bar(stat=\"identity\")+coord_flip()+ labs(\n    title = \"Discordant(Xpert Positive,culture negative cases)\",\n    x= \"specimen\",\n    y= \"Proportion\")\n\n\nlibrary(gridExtra)\ngrid.arrange(p1,p2)\n\nmaster2 %>% filter(xpert==\"Negative\",culture==\"Positive\") %>% summarize(n=n(),mean_TTP= mean(time), sd(time))\n\nmaster2$ctd = ifelse(master2$xpert==\"Negative\" & master2$culture==\"Positive\",\"Discordant\",master2$ct)\n\nsummary(as.factor(master2$ctd))\n\n\nfit1= aov(master2$time~master2$ctd)\nsummary(fit1)\nTukeyHSD(fit1)\n\n\nmaster2  %>%filter(!is.na(ctd)) %>%   ggplot(aes(x= reorder(ctd,time,FUN=median),y=time,fill=ctd))+geom_boxplot()+ coord_flip()+\n  labs( title = \" Time to positivity decreases with higher Ct\",\n        x = \"Ct\",\n        y= \"Time to positivity\")\n\n\nwrite.csv(master2,\"good_doc.csv\")",
    "created" : 1506250234202.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1374614915",
    "id" : "6FD4B412",
    "lastKnownWriteTime" : 1506250397,
    "last_content_update" : 1506252607864,
    "path" : "~/Downloads/gene_xpert/genexpert/genex.R",
    "project_path" : "genex.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}